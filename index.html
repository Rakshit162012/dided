<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Master 3√®me - Pr√©paration Brevet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary: #0b1b3b;
      --accent: #ffb400;
      --bg-light: #f5f7fb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-md: 10px;
      --radius-lg: 18px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-light);
      color: var(--text-main);
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.3);
    }

    .nav-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0.6rem 1.2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .logo {
      font-weight: 800;
      letter-spacing: 0.08em;
      font-size: 1rem;
      text-transform: uppercase;
    }

    .nav-links {
      display: flex;
      gap: 1.2rem;
      align-items: center;
      font-size: 0.95rem;
      flex-wrap: wrap;
    }

    .nav-links a {
      padding: 0.35rem 0.6rem;
      border-radius: 999px;
      transition: background 0.2s, color 0.2s, transform 0.1s;
    }

    .nav-links a:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
    }

    .nav-links a.active-link {
      background: var(--accent);
      color: #111827;
      font-weight: 600;
    }

    .nav-toggle {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
    }

    .nav-toggle span {
      width: 22px;
      height: 2px;
      background: #ffffff;
      border-radius: 999px;
      transition: transform 0.2s, opacity 0.2s;
    }

    .nav-toggle.open span:nth-child(1) {
      transform: translateY(7px) rotate(45deg);
    }

    .nav-toggle.open span:nth-child(2) {
      opacity: 0;
    }

    .nav-toggle.open span:nth-child(3) {
      transform: translateY(-7px) rotate(-45deg);
    }

    @media (max-width: 900px) {
      .nav-container {
        flex-wrap: wrap;
        align-items: flex-start;
      }
    }

    @media (max-width: 720px) {
      .nav-links {
        position: fixed;
        inset: 52px 0 auto 0;
        background: var(--primary);
        flex-direction: column;
        padding: 0.8rem 1.2rem 1.2rem;
        transform: translateY(-120%);
        transition: transform 0.22s ease-out;
      }

      .nav-links.open {
        transform: translateY(0);
      }

      .nav-toggle {
        display: flex;
      }
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.2rem 3rem;
      min-height: calc(100vh - 80px);
    }

    .page {
      display: none;
      margin-bottom: 3rem;
    }

    .page.active {
      display: block;
    }

    .section-title {
      font-size: 1.6rem;
      margin-bottom: 0.75rem;
    }

    .section-subtitle {
      color: var(--text-muted);
      margin-bottom: 1rem;
      font-size: 0.96rem;
    }

    /* ---------- PAGE : ACCUEIL ---------- */
    .hero {
      background: linear-gradient(135deg, var(--primary), #1f2a5c);
      border-radius: var(--radius-lg);
      padding: 2.2rem 2.1rem;
      color: #ffffff;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.2fr);
      gap: 2rem;
      box-shadow: var(--shadow-soft);
      margin-top: 1.2rem;
    }

    .hero-title {
      font-size: 2.1rem;
      margin-bottom: 0.5rem;
    }

    .hero-subtitle {
      font-size: 1rem;
      color: #e5e7eb;
      max-width: 32rem;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem 0 1.7rem;
    }

    .hero-badge {
      background: rgba(15, 23, 42, 0.3);
      border-radius: 999px;
      padding: 0.3rem 0.7rem;
      font-size: 0.8rem;
      border: 1px solid rgba(156, 163, 175, 0.3);
    }

    .cta-primary {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.6rem;
      border-radius: 999px;
      background: var(--accent);
      color: #111827;
      font-weight: 700;
      letter-spacing: 0.03em;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.25);
      transition: transform 0.1s, box-shadow 0.1s, background 0.1s;
    }

    .cta-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.28);
      background: #ffc94a;
    }

    .cta-primary span {
      margin-left: 0.4rem;
    }

    .hero-side {
      background: rgba(15, 23, 42, 0.18);
      border-radius: var(--radius-md);
      padding: 1.4rem 1.3rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.7rem;
    }

    .hero-side-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .hero-side-list {
      font-size: 0.92rem;
      color: #e5e7eb;
      list-style: none;
    }

    .hero-side-list li {
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .hero-side-tagline {
      margin-top: 0.7rem;
      font-size: 0.86rem;
      color: #d1d5db;
    }

    @media (max-width: 880px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .alert-urgent {
      background: linear-gradient(120deg, #ffb400, #ff7a00);
      color: #111827;
      border-radius: var(--radius-md);
      padding: 1rem 1.2rem;
      margin-top: 1.8rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      box-shadow: var(--shadow-soft);
    }

    .alert-urgent-title {
      font-weight: 800;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .alert-urgent-list {
      list-style: disc;
      padding-left: 1.3rem;
      font-size: 0.9rem;
    }

    .feature-grid {
      margin-top: 2rem;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 1.4rem;
    }

    @media (max-width: 960px) {
      .feature-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .feature-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .feature-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1.1rem 1rem;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 160px;
      border: 1px solid #e5e7eb;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
    }

    .feature-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
    }

    .feature-icon {
      font-size: 1.6rem;
      margin-bottom: 0.2rem;
    }

    .feature-title {
      font-weight: 700;
      margin-bottom: 0.2rem;
    }

    .feature-text {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.7rem;
    }

    .feature-link {
      margin-top: auto;
      font-size: 0.88rem;
      font-weight: 600;
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* ---------- RESSOURCES INDEX ---------- */
    .subjects-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.4rem;
      margin-top: 1.2rem;
    }

    @media (max-width: 780px) {
      .subjects-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .subject-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1.1rem 1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .subject-title {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .subject-tag {
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .subject-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .subject-link {
      margin-top: 0.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* ---------- SOUS-PAGES DE MATI√àRES (RESSOURCES) ---------- */
    .subject-page {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1.2rem 1.1rem 1.3rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      margin-top: 1.3rem;
    }

    .subject-page-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.7rem;
      margin-bottom: 0.5rem;
    }

    .subject-page-title {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .subject-page-tagline {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .subject-back {
      font-size: 0.86rem;
      color: var(--primary);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      margin-bottom: 0.4rem;
      cursor: pointer;
    }

    .resource-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.9rem;
      margin-top: 0.6rem;
    }

    @media (max-width: 680px) {
      .resource-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    details {
      border-radius: 8px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 0.6rem 0.7rem;
    }

    details[open] {
      background: #f3f4ff;
      border-color: #c7d2fe;
    }

    summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 0.94rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    summary::-webkit-details-marker {
      display: none;
    }

    .summary-prefix {
      font-size: 1rem;
    }

    details > div {
      margin-top: 0.5rem;
      font-size: 0.88rem;
      color: var(--text-muted);
    }

    .resource-links {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-top: 0.3rem;
    }

    .resource-link {
      font-size: 0.88rem;
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .resource-pill {
      display: inline-flex;
      align-items: center;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: #374151;
    }

    /* ---------- PAGE : OUTILS ---------- */
    .tools-grid {
      margin-top: 1.2rem;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.2rem;
    }

    @media (max-width: 720px) {
      .tools-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .tool-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1rem 0.95rem 1.1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .tool-title {
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .tool-badge {
      font-size: 0.75rem;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .tool-text {
      font-size: 0.88rem;
      color: var(--text-muted);
    }

    .tool-placeholder {
      margin-top: 0.3rem;
      border-radius: 10px;
      overflow: hidden;
      border: 1px dashed #d1d5db;
      background: #f9fafb;
    }

    .tool-note {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.4rem;
    }

    /* ---------- PAGE : AGENDA & SUIVI ---------- */
    .calendar-block {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1rem 1rem 1.3rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      margin-top: 1.2rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.6rem;
      margin-bottom: 0.7rem;
    }

    .calendar-title {
      font-size: 1.05rem;
      font-weight: 700;
    }

    .calendar-help {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .calendar-placeholder {
      border-radius: 12px;
      overflow: hidden;
      border: 1px dashed #d1d5db;
      background: #f9fafb;
      margin-top: 0.6rem;
    }

    .dashboard-grid {
      display: none;
    }

    .dashboard-info {
      display: none;
    }

    .dashboard-placeholder {
      display: none;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: #374151;
    }

    footer {
      text-align: center;
      font-size: 0.8rem;
      padding: 1rem 0 0.8rem;
      color: var(--text-muted);
    }

    /* ---------- BARRE D‚ÄôACCUEIL / MODALE ---------- */
    .welcome-bar {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      font-size: 0.9rem;
      margin-left: auto;
    }

    .welcome-link {
      border: none;
      background: none;
      color: #ffb400;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .name-gate {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .name-gate--hidden {
      display: none;
    }

    .name-gate__backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
    }

    .name-gate__content {
      position: relative;
      z-index: 1;
      max-width: 380px;
      width: 90%;
      background: #0b1b3b;
      color: #f9fafb;
      padding: 1.5rem 1.4rem;
      border-radius: 12px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.6);
    }

    .name-gate__label {
      display: block;
      margin-top: 0.7rem;
      margin-bottom: 0.25rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .name-gate__row {
      display: flex;
      gap: 0.5rem;
    }

    .name-gate__row > div {
      flex: 1;
    }

    .name-gate__input,
    .name-gate__select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 6px;
      border: 1px solid #cbd5f5;
      font-size: 0.92rem;
    }

    .name-gate__input:focus,
    .name-gate__select:focus {
      outline: 2px solid #ffb400;
      outline-offset: 2px;
    }

    .name-gate__error {
      min-height: 1.1em;
      margin-top: 0.25rem;
      color: #fed7d7;
      font-size: 0.82rem;
    }

    .name-gate__submit {
      margin-top: 1rem;
      width: 100%;
      padding: 0.6rem 0.8rem;
      border-radius: 999px;
      border: none;
      background: #ffb400;
      color: #0b1b3b;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .name-gate__submit:hover {
      background: #ffd260;
    }

    .name-gate__secondary {
      margin-top: 0.5rem;
      width: 100%;
      padding: 0.45rem 0.8rem;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.82rem;
    }

    .name-gate__toggle {
      margin-top: 0.6rem;
      text-align: center;
      font-size: 0.82rem;
    }

    .name-gate__toggle button {
      border: none;
      background: none;
      color: #ffb400;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.82rem;
      padding: 0;
    }

    /* ---------- BREVET BLANC PAGES ---------- */
    .bb-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.4rem;
      margin-top: 1.2rem;
    }

    @media (max-width: 780px) {
      .bb-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .bb-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1.1rem 1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .bb-card-title {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .bb-card-tag {
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .bb-card-link {
      margin-top: 0.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .bb-section {
      margin-top: 0.8rem;
    }

    .bb-section-title {
      font-weight: 700;
      margin-bottom: 0.25rem;
      font-size: 1rem;
    }

    .bb-section-subtitle {
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
    }

    /* ---------- CLASSEMENT / XP PAGE ---------- */
    .xp-summary {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1rem 1rem 1.1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
      margin-top: 1.2rem;
      margin-bottom: 1.4rem;
    }

    .xp-summary p {
      margin: 0.1rem 0;
    }

    .ranking-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.4rem;
    }

    @media (max-width: 780px) {
      .ranking-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .ranking-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 1rem 1rem 1.1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.07);
    }

    .ranking-title {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }

    .ranking-note {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
    }

    table.ranking-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.88rem;
    }

    table.ranking-table th,
    table.ranking-table td {
      padding: 0.3rem 0.35rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    table.ranking-table th {
      font-weight: 600;
      background: #f9fafb;
    }

    table.ranking-table tr.highlight {
      background: #fef3c7;
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-container">
      <div class="logo">MASTER 3√àME</div>
      <nav>
        <div class="nav-toggle" id="navToggle" aria-label="Ouvrir le menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </div>
        <div class="nav-links" id="navLinks">
          <a href="#accueil" data-page="accueil" class="active-link">Accueil</a>
          <a href="#ressources" data-page="ressources">Ressources (Fiches)</a>
          <a href="#brevet-blanc" data-page="brevet-blanc">Brevet Blanc</a>
          <a href="#outils" data-page="outils">Outils</a>
          <a href="#agenda" data-page="agenda">Agenda & Suivi</a>
          <a href="#classement" data-page="classement">Classement / XP</a>
        </div>
      </nav>

      <div id="welcome-bar" class="welcome-bar" aria-live="polite">
        <span id="welcome-message"></span>
        <button id="change-user-btn" type="button" class="welcome-link">
          Changer d‚Äôutilisateur
        </button>
        <button id="logout-btn" type="button" class="welcome-link">
          Se d√©connecter
        </button>
      </div>
    </div>
  </header>

  <!-- MODALE D‚ÄôAUTHENTIFICATION : INSCRIPTION + CONNEXION -->
  <div
    id="auth-gate"
    class="name-gate name-gate--hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="auth-gate-title"
  >
    <div class="name-gate__backdrop"></div>
    <div class="name-gate__content" role="document">
      <h2 id="auth-gate-title">Bienvenue sur Master 3√®me</h2>
      <p id="auth-gate-desc">
        Cr√©e ton compte ou connecte-toi pour sauvegarder ta progression.
      </p>

      <form id="auth-form" novalidate>
        <input type="hidden" id="auth-mode" value="signup" />

        <div class="name-gate__row">
          <div>
            <label for="first-name" class="name-gate__label">Pr√©nom</label>
            <input
              id="first-name"
              name="firstName"
              type="text"
              class="name-gate__input"
              autocomplete="given-name"
              required
              minlength="2"
              maxlength="50"
            />
          </div>
          <div>
            <label for="last-name" class="name-gate__label">Nom</label>
            <input
              id="last-name"
              name="lastName"
              type="text"
              class="name-gate__input"
              autocomplete="family-name"
              required
              minlength="2"
              maxlength="50"
            />
          </div>
        </div>

        <label for="class-name" class="name-gate__label">Classe</label>
        <select
          id="class-name"
          name="className"
          class="name-gate__select"
          required
        >
          <option value="">Choisis ta classe</option>
          <option value="3¬∫1">3¬∫1</option>
          <option value="3¬∫2">3¬∫2</option>
          <option value="3¬∫3">3¬∫3</option>
          <option value="3¬∫4">3¬∫4</option>
          <option value="3¬∫5">3¬∫5</option>
        </select>

        <label for="password" class="name-gate__label">Mot de passe</label>
        <input
          id="password"
          name="password"
          type="password"
          class="name-gate__input"
          autocomplete="new-password"
          required
          minlength="4"
          maxlength="50"
        />

        <p id="auth-error" class="name-gate__error" role="alert" aria-live="assertive"></p>

        <button type="submit" class="name-gate__submit" id="auth-submit-btn">
          Cr√©er mon compte
        </button>

        <button type="button" id="auth-cancel" class="name-gate__secondary">
          Continuer sans sauvegarder
        </button>

        <p class="name-gate__toggle">
          <span id="auth-toggle-text">Tu as d√©j√† un compte ?</span>
          <button type="button" id="auth-toggle-btn">Se connecter</button>
        </p>
      </form>
    </div>
  </div>

  <noscript>
    <main>
      <h1>Bienvenue</h1>
      <p>Active JavaScript pour utiliser ce site.</p>
    </main>
  </noscript>

  <main>
    <!-- ACCUEIL -->
    <section id="accueil" class="page active">
      <div class="hero">
        <div>
          <h1 class="hero-title">MASTER 3√àME : Votre Brevet, ma√Ætris√©.</h1>
          <p class="hero-subtitle">
            La plateforme unique pour organiser, r√©viser et dominer votre ann√©e de Troisi√®me, sans stress et avec une m√©thode claire.
          </p>
          <div class="hero-badges">
            <span class="hero-badge">üìö Toutes les mati√®res</span>
            <span class="hero-badge">‚è±Ô∏è Objectif Brevet 2025</span>
            <span class="hero-badge">‚úÖ Suivi de progression</span>
          </div>
          <a href="#ressources" data-link="ressources">
            <button class="cta-primary">
              LANCER MES R√âVISIONS <span>üöÄ</span>
            </button>
          </a>
        </div>
        <aside class="hero-side">
          <p class="hero-side-title">Pourquoi utiliser Master 3√®me ?</p>
          <ul class="hero-side-list">
            <li>‚úÖ Fiches organis√©es par mati√®re.</li>
            <li>‚úÖ Liens vers cartes mentales, quiz et flashcards.</li>
            <li>‚úÖ Outils pour calculer points et moyenne.</li>
            <li>‚úÖ Agenda connect√© √† ton planning r√©el.</li>
          </ul>
          <p class="hero-side-tagline">
            Commence aujourd'hui, avance un peu chaque semaine, et arrive serein au Brevet.
          </p>
        </aside>
      </div>

      <div class="alert-urgent" aria-label="Annonces urgentes">
        <div class="alert-urgent-title">üö® ANNONCES URGENTES üö®</div>
        <ul class="alert-urgent-list">
          <li>Simule d√®s maintenant tes points au Brevet pour fixer ton objectif.</li>
          <li>Ajoute les dates de tes contr√¥les importants dans l'agenda.</li>
          <li>Planifie au moins 2 s√©ances de r√©vision par semaine, par mati√®re cl√©.</li>
        </ul>
      </div>

      <div class="feature-grid">
        <article class="feature-card">
          <div>
            <div class="feature-icon">üìë</div>
            <h3 class="feature-title">Fiches & Ressources</h3>
            <p class="feature-text">
              Acc√®de aux fiches de r√©vision, cartes mentales, quiz et exercices pour chaque mati√®re du Brevet.
            </p>
          </div>
          <a href="#ressources" data-link="ressources" class="feature-link">
            Aller aux ressources <span>‚Üí</span>
          </a>
        </article>

        <article class="feature-card">
          <div>
            <div class="feature-icon">üß∞</div>
            <h3 class="feature-title">Outils</h3>
            <p class="feature-text">
              Utilise les calculateurs de points et de moyenne g√©n√©rale pour suivre ton niveau.
            </p>
          </div>
          <a href="#outils" data-link="outils" class="feature-link">
            D√©couvrir les outils <span>‚Üí</span>
          </a>
        </article>

        <article class="feature-card">
          <div>
            <div class="feature-icon">üóìÔ∏è</div>
            <h3 class="feature-title">Agenda & Suivi</h3>
            <p class="feature-text">
              Organise tes semaines, note tes contr√¥les et visualise ton planning.
            </p>
          </div>
          <a href="#agenda" data-link="agenda" class="feature-link">
            Voir l'agenda <span>‚Üí</span>
          </a>
        </article>

        <article class="feature-card">
          <div>
            <div class="feature-icon">üß™</div>
            <h3 class="feature-title">Brevet Blanc</h3>
            <p class="feature-text">
              Retrouve des sujets complets de Brevet blanc et leurs corrections pour t‚Äôentra√Æner.
            </p>
          </div>
          <a href="#brevet-blanc" data-link="brevet-blanc" class="feature-link">
            Acc√©der aux Brevets blancs <span>‚Üí</span>
          </a>
        </article>
      </div>
    </section>

    <!-- ICI tu gardes toutes tes sections existantes : RESSOURCES, BREVET BLANC, OUTILS, AGENDA, etc. -->
    <!-- (contenu identique √† ton dernier fichier, non r√©p√©t√© ici pour gagner de la place) -->

    <!-- CLASSEMENT / XP PAGE -->
    <section id="classement" class="page">
      <h2 class="section-title">Classement & XP</h2>
      <p class="section-subtitle">
        Visualise tes points d‚ÄôXP et compare-toi aux autres √©l√®ves de ta classe et √† tous les utilisateurs.
      </p>

      <div class="xp-summary">
        <p id="xp-current-user">Tu n‚Äôes pas connect√©. Connecte-toi pour voir ton XP.</p>
        <p class="muted">
          Plus tard, l‚ÄôXP sera gagn√© automatiquement en fonction du temps de r√©vision et des qu√™tes que tu compl√®tes.
        </p>
      </div>

      <div class="ranking-grid">
        <article class="ranking-card">
          <h3 class="ranking-title">Classement dans ta classe</h3>
          <p class="ranking-note">
            Classement des √©l√®ves de ta classe (3¬∫1, 3¬∫2, 3¬∫3, 3¬∫4 ou 3¬∫5) selon l‚ÄôXP total.
          </p>
          <div id="class-ranking-container">
            <p class="muted">Connecte-toi pour voir le classement de ta classe.</p>
          </div>
        </article>

        <article class="ranking-card">
          <h3 class="ranking-title">Classement global (tous les utilisateurs)</h3>
          <p class="ranking-note">
            Classement de tous les comptes cr√©√©s sur cette plateforme, selon l‚ÄôXP total.
          </p>
          <div id="global-ranking-container">
            <p class="muted">Connecte-toi ou cr√©e un compte pour appara√Ætre dans le classement global.</p>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer>
    ¬© <span id="year"></span> Master 3√®me ¬∑ Pr√©paration Brevet.
  </footer>

  <script>
    // ---------- NAVIGATION / PAGES ----------
    const navToggle = document.getElementById('navToggle');
    const navLinks = document.getElementById('navLinks');
    const linkItems = navLinks.querySelectorAll('a');
    const pages = document.querySelectorAll('.page');

    function showPage(id) {
      pages.forEach(p => {
        p.classList.toggle('active', p.id === id);
      });
      linkItems.forEach(link => {
        const page = link.dataset.page;
        link.classList.toggle(
          'active-link',
          page === id ||
            (id && id.startsWith('ressources-') && page === 'ressources') ||
            (id && id.startsWith('bb-') && page === 'brevet-blanc')
        );
      });
      window.scrollTo({ top: 0, behavior: 'instant' });
    }

    function getHashPage() {
      const hash = window.location.hash.replace('#', '');
      if (!hash) return 'accueil';
      const validIds = Array.from(pages).map(p => p.id);
      return validIds.includes(hash) ? hash : 'accueil';
    }

    function handleHashChange() {
      const pageId = getHashPage();
      showPage(pageId);
      if (pageId === 'classement') {
        refreshRankingPage();
      }
    }

    window.addEventListener('hashchange', handleHashChange);
    window.addEventListener('load', () => {
      document.getElementById('year').textContent = new Date().getFullYear();
      handleHashChange();
    });

    navToggle.addEventListener('click', () => {
      const isOpen = navLinks.classList.toggle('open');
      navToggle.classList.toggle('open');
      navToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });

    linkItems.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 720) {
          navLinks.classList.remove('open');
          navToggle.classList.remove('open');
          navToggle.setAttribute('aria-expanded', 'false');
        }
      });
    });

    document.querySelectorAll('[data-link]').forEach(el => {
      el.addEventListener('click', (e) => {
        const target = el.getAttribute('data-link');
        if (target) {
          e.preventDefault();
          window.location.hash = target;
        }
      });
    });

    // ---------- AUTH SIMPLE C√îT√â FRONT ----------
    const USERS_KEY = 'm3_users';
    const CURRENT_USER_KEY = 'm3_current_user_id';
    const DEVICE_LAST_USER_KEY = 'm3_last_user_id';

    function supportsLocalStorage() {
      try {
        const testKey = '__test_ls__';
        window.localStorage.setItem(testKey, '1');
        window.localStorage.removeItem(testKey);
        return true;
      } catch (e) {
        return false;
      }
    }

    const hasLocal = supportsLocalStorage();

    function loadUsers() {
      if (!hasLocal) return [];
      const raw = localStorage.getItem(USERS_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveUsers(users) {
      if (!hasLocal) return;
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
    }

    function genUserId(firstName, lastName) {
      const base = (firstName + '_' + lastName + '_' + Date.now()).toLowerCase();
      return base.replace(/[^a-z0-9_]/g, '');
    }

    function hashPassword(pw) {
      let hash = 0;
      for (let i = 0; i < pw.length; i++) {
        hash = (hash << 5) - hash + pw.charCodeAt(i);
        hash |= 0;
      }
      return String(hash);
    }

    function findUser(firstName, lastName) {
      const users = loadUsers();
      return users.find(
        u =>
          u.firstName.toLowerCase() === firstName.toLowerCase().trim() &&
          u.lastName.toLowerCase() === lastName.toLowerCase().trim()
      );
    }

    function ensureUserDefaults(user) {
      if (typeof user.xp !== 'number') {
        user.xp = 0;
      }
      if (!user.history || typeof user.history !== 'object') {
        user.history = {
          lastVisit: Date.now(),
          visits: []
        };
      }
      return user;
    }

    function upsertUser(user) {
      user = ensureUserDefaults(user);
      const users = loadUsers();
      const idx = users.findIndex(u => u.id === user.id);
      if (idx >= 0) {
        users[idx] = user;
      } else {
        users.push(user);
      }
      saveUsers(users);
    }

    function setCurrentUserId(id) {
      if (!hasLocal) return;
      localStorage.setItem(CURRENT_USER_KEY, id);
      localStorage.setItem(DEVICE_LAST_USER_KEY, id);
    }

    function getCurrentUserId() {
      if (!hasLocal) return null;
      return localStorage.getItem(CURRENT_USER_KEY);
    }

    function getDeviceLastUserId() {
      if (!hasLocal) return null;
      return localStorage.getItem(DEVICE_LAST_USER_KEY);
    }

    function clearCurrentUser() {
      if (!hasLocal) return;
      localStorage.removeItem(CURRENT_USER_KEY);
    }

    function getCurrentUser() {
      const id = getCurrentUserId();
      if (!id) return null;
      const users = loadUsers();
      const user = users.find(u => u.id === id) || null;
      return user ? ensureUserDefaults(user) : null;
    }

    function getUserHistory(user) {
      if (!user.history || typeof user.history !== 'object') {
        user.history = {
          lastVisit: Date.now(),
          visits: []
        };
      }
      return user.history;
    }

    function updateUserHistoryOnVisit(user) {
      const history = getUserHistory(user);
      history.lastVisit = Date.now();
      history.visits.push({
        date: Date.now(),
        page: getHashPage(),
      });
      user.history = history;
      upsertUser(user);
    }

    const welcomeMsg = document.getElementById('welcome-message');
    const changeUserBtn = document.getElementById('change-user-btn');
    const logoutBtn = document.getElementById('logout-btn');

    function setWelcome(user) {
      if (!welcomeMsg) return;
      if (!user) {
        welcomeMsg.textContent = '';
        return;
      }
      welcomeMsg.textContent =
        'Bienvenue, ' + user.firstName + ' ' + user.lastName + ' (' + user.className + ').';
    }

    // ---------- LOGIQUE DE LA MODALE D‚ÄôAUTH ----------
    const authGate = document.getElementById('auth-gate');
    const authForm = document.getElementById('auth-form');
    const authModeInput = document.getElementById('auth-mode');
    const firstNameInput = document.getElementById('first-name');
    const lastNameInput = document.getElementById('last-name');
    const classSelect = document.getElementById('class-name');
    const passwordInput = document.getElementById('password');
    const authError = document.getElementById('auth-error');
    const authSubmitBtn = document.getElementById('auth-submit-btn');
    const authCancelBtn = document.getElementById('auth-cancel');
    const authToggleBtn = document.getElementById('auth-toggle-btn');
    const authToggleText = document.getElementById('auth-toggle-text');

    function getFocusableElements(container) {
      return Array.from(
        container.querySelectorAll(
          'a[href], button:not([disabled]), textarea, input:not([disabled]), select, [tabindex]:not([tabindex="-1"])'
        )
      );
    }

    function openAuthGate(mode = 'signup') {
      authModeInput.value = mode;
      authError.textContent = '';
      passwordInput.value = '';
      if (mode === 'signup') {
        authSubmitBtn.textContent = 'Cr√©er mon compte';
        passwordInput.setAttribute('autocomplete', 'new-password');
        authToggleText.textContent = 'Tu as d√©j√† un compte ?';
        authToggleBtn.textContent = 'Se connecter';
      } else {
        authSubmitBtn.textContent = 'Se connecter';
        passwordInput.setAttribute('autocomplete', 'current-password');
        authToggleText.textContent = "Tu n'as pas encore de compte ?";
        authToggleBtn.textContent = 'Cr√©er un compte';
      }

      authGate.classList.remove('name-gate--hidden');

      const focusables = getFocusableElements(authGate);
      const first = focusables[0];
      const last = focusables[focusables.length - 1];

      if (firstNameInput) firstNameInput.focus();

      function trap(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        } else if (e.key === 'Escape') {
          e.preventDefault();
          closeAuthGate();
        }
      }

      authGate.addEventListener('keydown', trap);
      authGate._cleanupTrap = () => authGate.removeEventListener('keydown', trap);
    }

    function closeAuthGate() {
      if (authGate._cleanupTrap) authGate._cleanupTrap();
      authGate.classList.add('name-gate--hidden');
    }

    function validateAuthForm(mode) {
      const fn = firstNameInput.value.trim();
      const ln = lastNameInput.value.trim();
      const cl = classSelect.value;
      const pw = passwordInput.value;

      if (!fn || fn.length < 2) {
        return 'Merci de saisir un pr√©nom valide.';
      }
      if (!ln || ln.length < 2) {
        return 'Merci de saisir un nom valide.';
      }
      if (!cl) {
        return 'Merci de choisir ta classe.';
      }
      if (!pw || pw.length < 4) {
        return 'Le mot de passe doit contenir au moins 4 caract√®res.';
      }

      if (mode === 'signup') {
        const existing = findUser(fn, ln);
        if (existing) {
          return 'Un compte avec ce pr√©nom et ce nom existe d√©j√†. Connecte-toi plut√¥t.';
        }
      } else if (mode === 'login') {
        const existing = findUser(fn, ln);
        if (!existing) {
          return 'Aucun compte trouv√© avec ce pr√©nom et ce nom. Cr√©e un compte.';
        }
        if (existing.passwordHash !== hashPassword(pw)) {
          return 'Mot de passe incorrect.';
        }
      }
      return '';
    }

    authForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const mode = authModeInput.value || 'signup';
      const errorMsg = validateAuthForm(mode);
      if (errorMsg) {
        authError.textContent = errorMsg;
        return;
      }
      const fn = firstNameInput.value.trim();
      const ln = lastNameInput.value.trim();
      const cl = classSelect.value;
      const pw = passwordInput.value;

      if (mode === 'signup') {
        const newUser = {
          id: genUserId(fn, ln),
          firstName: fn,
          lastName: ln,
          className: cl,
          passwordHash: hashPassword(pw),
          createdAt: Date.now(),
          xp: 0,
          history: {
            lastVisit: Date.now(),
            visits: []
          }
        };
        upsertUser(newUser);
        setCurrentUserId(newUser.id);
        setWelcome(newUser);
        closeAuthGate();
        updateUserHistoryOnVisit(newUser);
        if (getHashPage() === 'classement') {
          refreshRankingPage();
        }
      } else {
        const existing = findUser(fn, ln);
        const user = ensureUserDefaults(existing);
        setCurrentUserId(user.id);
        setWelcome(user);
        closeAuthGate();
        updateUserHistoryOnVisit(user);
        if (getHashPage() === 'classement') {
          refreshRankingPage();
        }
      }
    });

    authToggleBtn.addEventListener('click', () => {
      const mode = authModeInput.value === 'signup' ? 'login' : 'signup';
      openAuthGate(mode);
    });

    authCancelBtn.addEventListener('click', () => {
      clearCurrentUser();
      setWelcome(null);
      closeAuthGate();
      if (getHashPage() === 'classement') {
        refreshRankingPage();
      }
    });

    if (changeUserBtn) {
      changeUserBtn.addEventListener('click', () => {
        const currentUser = getCurrentUser();
        if (currentUser) {
          firstNameInput.value = currentUser.firstName;
          lastNameInput.value = currentUser.lastName;
          classSelect.value = currentUser.className || '';
        }
        openAuthGate('login');
      });
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        clearCurrentUser();
        setWelcome(null);
        if (getHashPage() === 'classement') {
          refreshRankingPage();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (!hasLocal) {
        return;
      }
      const current = getCurrentUser();
      if (current) {
        setWelcome(current);
        updateUserHistoryOnVisit(current);
        if (getHashPage() === 'classement') {
          refreshRankingPage();
        }
        return;
      }

      const lastId = getDeviceLastUserId();
      if (lastId) {
        const users = loadUsers();
        const user = users.find(u => u.id === lastId);
        if (user) {
          firstNameInput.value = user.firstName;
          lastNameInput.value = user.lastName;
          classSelect.value = user.className || '';
        }
      }
      openAuthGate('signup');
    });

    // ---------- CLASSEMENT / XP ----------
    const xpCurrentUserEl = document.getElementById('xp-current-user');
    const classRankingContainer = document.getElementById('class-ranking-container');
    const globalRankingContainer = document.getElementById('global-ranking-container');

    function buildRankingTable(users, currentUser) {
      if (!users.length) {
        const p = document.createElement('p');
        p.className = 'muted';
        p.textContent = 'Aucun utilisateur pour l‚Äôinstant.';
        return p;
      }

      const table = document.createElement('table');
      table.className = 'ranking-table';

      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      ['#', 'Nom', 'Classe', 'XP'].forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      const tbody = document.createElement('tbody');
      users.forEach((u, idx) => {
        const tr = document.createElement('tr');
        if (currentUser && u.id === currentUser.id) {
          tr.classList.add('highlight');
        }
        const rankTd = document.createElement('td');
        rankTd.textContent = String(idx + 1);
        const nameTd = document.createElement('td');
        nameTd.textContent = u.firstName + ' ' + u.lastName;
        const classTd = document.createElement('td');
        classTd.textContent = u.className || '-';
        const xpTd = document.createElement('td');
        xpTd.textContent = typeof u.xp === 'number' ? u.xp : 0;

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(classTd);
        tr.appendChild(xpTd);
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      return table;
    }

    function refreshRankingPage() {
      if (!xpCurrentUserEl || !classRankingContainer || !globalRankingContainer) return;

      const currentUser = getCurrentUser();
      const allUsers = loadUsers().map(ensureUserDefaults);

      if (!currentUser) {
        xpCurrentUserEl.textContent = 'Tu n‚Äôes pas connect√©. Connecte-toi pour voir ton XP.';
        classRankingContainer.innerHTML = '';
        const pClass = document.createElement('p');
        pClass.className = 'muted';
        pClass.textContent = 'Connecte-toi pour voir le classement de ta classe.';
        classRankingContainer.appendChild(pClass);

        globalRankingContainer.innerHTML = '';
        const pGlobal = document.createElement('p');
        pGlobal.className = 'muted';
        pGlobal.textContent = 'Connecte-toi ou cr√©e un compte pour appara√Ætre dans le classement global.';
        globalRankingContainer.appendChild(pGlobal);
        return;
      }

      const xp = typeof currentUser.xp === 'number' ? currentUser.xp : 0;
      xpCurrentUserEl.textContent =
        'Tu as actuellement ' + xp + ' XP.';

      // Classement par classe
      const sameClassUsers = allUsers
        .filter(u => u.className === currentUser.className)
        .sort((a, b) => (b.xp || 0) - (a.xp || 0));

      classRankingContainer.innerHTML = '';
      classRankingContainer.appendChild(buildRankingTable(sameClassUsers, currentUser));

      // Classement global
      const globalUsers = allUsers.sort((a, b) => (b.xp || 0) - (a.xp || 0));
      globalRankingContainer.innerHTML = '';
      globalRankingContainer.appendChild(buildRankingTable(globalUsers, currentUser));
    }
  </script>
</body>
</html>


